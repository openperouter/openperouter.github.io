<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="EVPN- VXLan concepts"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://openperouter.github.io/docs/concepts/evpn/"><meta property="og:site_name" content="OpenPERouter official docs"><meta property="og:title" content="EVPN - VXLan"><meta property="og:description" content="EVPN- VXLan concepts"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-06-15T15:03:22+02:00"><meta property="article:modified_time" content="2025-06-15T15:03:22+02:00"><title>EVPN - VXLan | OpenPERouter official docs</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://openperouter.github.io/docs/concepts/evpn/><link rel=stylesheet href=/book.min.d5e59cb0aa8d22a5813c62cd5e25d3d172489a369c61dc3f622ee96ae1ebb457.css integrity="sha256-1eWcsKqNIqWBPGLNXiXT0XJImjacYdw/Yi7pauHrtFc=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.73ba38f9e1c489ebc43cf7a53893d7b8c44b222dab5b130fa59e8fa3df0c8f5f.js integrity="sha256-c7o4+eHEievEPPelOJPXuMRLIi2rWxMPpZ6Po98Mj18=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>OpenPERouter official docs</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/concepts/>Concepts</a><ul><li><a href=/docs/concepts/evpn/ class=active>EVPN - VXLan</a></li><li><a href=/docs/concepts/passthrough/>L3 Passthrough</a></li></ul></li><li><a href=/docs/architecture/>Architecture</a></li><li><a href=/docs/installation/>Installation</a></li><li><a href=/docs/configuration/>Configuration</a><ul><li><a href=/docs/configuration/evpn/>EVPN Configuration</a></li><li><a href=/docs/configuration/passthrough/>Passthrough Configuration</a></li></ul></li><li><a href=/docs/examples/>Examples</a><ul><li><a href=/docs/examples/evpnexamples/>EVPN Examples</a><ul><li><a href=/docs/examples/evpnexamples/metallb/>MetalLB Integration</a></li><li><a href=/docs/examples/evpnexamples/kubevirt-multi-cluster/>Stretching a layer 2 overlay across multiple KubeVirt clusters</a></li><li><a href=/docs/examples/evpnexamples/calico/>Calico Integration</a></li><li><a href=/docs/examples/evpnexamples/kubevirt/>KubeVirt L2 Integration</a></li><li><a href=/docs/examples/evpnexamples/layer2/>Layer 2 Integration</a></li></ul></li><li><a href=/docs/examples/passthroughexamples/>Passthrough Examples</a><ul><li><a href=/docs/examples/passthroughexamples/metallb/>MetalLB Integration</a></li></ul></li></ul></li><li><a href=/docs/api-reference/>API Reference</a></li><li><a href=/docs/contributing/>Contributing</a><ul><li><a href=/docs/contributing/devenv/>The development environment</a></li><li><a href=/docs/contributing/code-of-conduct/>Code of Conduct</a></li><li><a href=/docs/contributing/how-to-release/>How to release</a></li></ul></li><li><a href=/docs/release-notes/>Release Notes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>EVPN - VXLan</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#underlay-connectivity>Underlay Connectivity</a><ul><li><a href=#vtep-ip-assignment>VTEP IP Assignment</a></li></ul></li><li><a href=#overlay-networks-vnis>Overlay Networks (VNIs)</a><ul><li><a href=#virtual-network-identifiers>Virtual Network Identifiers</a></li><li><a href=#l3-vni-components>L3 VNI Components</a></li></ul></li><li><a href=#control-plane-operations>Control Plane Operations</a><ul><li><a href=#route-advertisement-host--fabric>Route Advertisement (Host → Fabric)</a></li><li><a href=#route-reception-fabric--host>Route Reception (Fabric → Host)</a></li></ul></li><li><a href=#data-plane-operations>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow>Ingress Traffic Flow</a></li></ul></li><li><a href=#l2-vni>L2 VNI</a><ul><li></li></ul></li><li><a href=#data-plane-operations-1>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow-1>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow-1>Ingress Traffic Flow</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>OpenPERouter implements EVPN (Ethernet VPN) over VXLAN to provide scalable overlay networking. EVPN serves as the control plane protocol that enables the distribution of MAC and IP reachability information across the network fabric, while VXLAN provides the data plane encapsulation for overlay traffic.</p><p>The solution supports two main overlay types:</p><ul><li><p><strong>L3VNI (Layer 3 Virtual Network Identifier)</strong>: Creates routed overlay networks where IP connectivity is extended across the fabric. Each L3VNI corresponds to a VRF (Virtual Routing and Forwarding) instance that maintains separate routing tables and enables IP-based communication between endpoints.</p></li><li><p><strong>L2VNI (Layer 2 Virtual Network Identifier)</strong>: Creates bridged overlay networks where Layer 2 connectivity is extended across the fabric. L2VNIs enable MAC learning and forwarding, allowing endpoints to communicate at the Ethernet layer as if they were on the same physical LAN segment.</p></li></ul><p>Both overlay types can coexist and interoperate, enabling flexible network designs that combine routed and bridged domains as needed.</p><h2 id=underlay-connectivity>Underlay Connectivity
<a class=anchor href=#underlay-connectivity>#</a></h2><h3 id=vtep-ip-assignment>VTEP IP Assignment
<a class=anchor href=#vtep-ip-assignment>#</a></h3><p>Each OpenPERouter instance is assigned a unique VTEP (Virtual Tunnel End Point) IP address from a configured CIDR range. This VTEP IP serves as the identifier for the router within the fabric.</p><p>OpenPERouter establishes a BGP session with the fabric, advertising its VTEP IP to other routers. The VPN address family is enabled on this session, allowing the exchange of EVPN routes required for overlay connectivity.</p><p><img src=/images/openpebgpfabric.png alt></p><hr><h2 id=overlay-networks-vnis>Overlay Networks (VNIs)
<a class=anchor href=#overlay-networks-vnis>#</a></h2><h3 id=virtual-network-identifiers>Virtual Network Identifiers
<a class=anchor href=#virtual-network-identifiers>#</a></h3><p>OpenPERouter supports the creation of multiple VNIs (Virtual Network Identifiers), each corresponding to a separate EVPN tunnel. This enables multi-tenancy and network segmentation.</p><p>OpenPERouter supports the creation of L3 VNIs, allowing the extension of a routed domain via an
EVPN overlay:</p><p><img src=/images/openpebgphost.svg alt></p><p>It supports the creation of L2 VNIs, where the veth is directly connected to a layer 2 domain</p><p><img src=/images/openpel2host.svg alt></p><p>And it also supports a mixed scenario, where an L2 domain also belongs to a broader L3 domain
mapped to an L3 overlay</p><p><img src=/images/openpel2l3host.svg alt></p><h3 id=l3-vni-components>L3 VNI Components
<a class=anchor href=#l3-vni-components>#</a></h3><p>In addition to what&rsquo;s described in the <a href=https://openperouter.github.io/docs/concepts/#l3-vpn-components>concepts page</a>, for each Layer 3 VNI OpenPERouter automatically creates:</p><ul><li><strong>VXLAN Interface</strong>: Handles tunnel encapsulation/decapsulation</li><li><strong>Route Translation</strong>: Converts between BGP routes and EVPN Type 5 routes</li></ul><h4 id=ip-allocation-strategy>IP Allocation Strategy
<a class=anchor href=#ip-allocation-strategy>#</a></h4><p>The IP addresses for the veth pair are allocated from the configured <code>localcidr</code> for each VNI:</p><ul><li><strong>Router side</strong>: Always gets the first IP in the CIDR (e.g., <code>192.169.11.0</code>)</li><li><strong>Host side</strong>: Each node gets a different IP from the CIDR, starting from the second value (e.g., <code>192.169.11.15</code>)</li></ul><p>This consistent allocation strategy of the router IP simplifies configuration across all nodes, as any BGP-speaking
component on the host can use the same IP address for the router side of the veth pair.</p><h2 id=control-plane-operations>Control Plane Operations
<a class=anchor href=#control-plane-operations>#</a></h2><h3 id=route-advertisement-host--fabric>Route Advertisement (Host → Fabric)
<a class=anchor href=#route-advertisement-host--fabric>#</a></h3><p>When a BGP-speaking component (like MetalLB) advertises a prefix to OpenPERouter over a L3VNI session:</p><p><img src=/images/openpeadvertise.svg alt></p><ol><li>The host advertises the route with the veth interface IP as the next hop</li><li>OpenPERouter learns the route via the BGP session</li><li>OpenPERouter translates the route to an EVPN Type 5 route</li><li>The EVPN route is advertised to the fabric with the local VTEP as the next hop</li></ol><h3 id=route-reception-fabric--host>Route Reception (Fabric → Host)
<a class=anchor href=#route-reception-fabric--host>#</a></h3><p>When EVPN Type 5 routes are received from the fabric:</p><p><img src=/images/openpereceive.svg alt></p><ol><li>OpenPERouter installs the routes in the VRF corresponding to the VNI</li><li>OpenPERouter translates the EVPN routes to BGP routes</li><li>The BGP routes are advertised to the host via the veth interface</li><li>The host&rsquo;s BGP-speaking component learns and installs the routes</li></ol><h2 id=data-plane-operations>Data Plane Operations
<a class=anchor href=#data-plane-operations>#</a></h2><h3 id=egress-traffic-flow>Egress Traffic Flow
<a class=anchor href=#egress-traffic-flow>#</a></h3><p>Traffic destined for networks learned via EVPN follows this path:</p><ol><li><strong>Host Routing</strong>: Traffic is redirected to the veth interface corresponding to the VNI</li><li><strong>Encapsulation</strong>: OpenPERouter encapsulates the traffic in VXLAN packets with the appropriate VNI</li><li><strong>Fabric Routing</strong>: The fabric routes the VXLAN packets to the destination VTEP</li><li><strong>Delivery</strong>: The destination endpoint instance receives and processes the traffic</li></ol><h3 id=ingress-traffic-flow>Ingress Traffic Flow
<a class=anchor href=#ingress-traffic-flow>#</a></h3><p>VXLAN packets received from the fabric are processed as follows:</p><ol><li><strong>Decapsulation</strong>: OpenPERouter removes the VXLAN header</li><li><strong>VRF Routing</strong>: Traffic is routed within the VRF corresponding to the VNI</li><li><strong>Host Delivery</strong>: Traffic is forwarded to the host via the veth interface</li><li><strong>Final Routing</strong>: The host routes the traffic to the appropriate destination</li></ol><h2 id=l2-vni>L2 VNI
<a class=anchor href=#l2-vni>#</a></h2><p>For each Layer 2 VNI, OpenPERouter automatically creates:</p><ul><li><strong>Veth Pair</strong>: Named after the VNI (e.g., <code>host-200@pe-200</code>) for Layer 2 host connectivity</li><li><strong>Linux VRF</strong>: Optional, isolates the routing space for each VNI within the router&rsquo;s network namespace</li><li><strong>VXLAN Interface</strong>: Handles tunnel encapsulation/decapsulation</li></ul><h4 id=host-interface-management>Host Interface Management
<a class=anchor href=#host-interface-management>#</a></h4><p>Given the Layer 2 nature of these connections, OpenPERouter supports multiple interface management options:</p><ul><li><strong>Attaching to an existing bridge</strong>: If a bridge already exists and is used by other components, OpenPERouter can attach the veth interface to it</li><li><strong>Creating a new bridge</strong>: OpenPERouter can create a bridge and attach the veth interface directly to it.</li><li><strong>Direct veth usage</strong>: With the understanding that the veth interface may disappear if the pod gets restarted, the veth can be used directly to extend an existing Layer 2 domain</li></ul><h5 id=automatic-bridge-creation>Automatic Bridge Creation
<a class=anchor href=#automatic-bridge-creation>#</a></h5><p>The automatic bridge creation is useful for those scenarios where an existing layer 2 domain is extended automatically through the veth interface:
when the router pod is deleted or restarted, the veth interface is removed (and then recreated upon reconciliation), while the bridge remains intact,
making it a good candidate for attaching to an existing layer 2 domain (i.e. setting it as master of a macvlan multus interface).</p><h2 id=data-plane-operations-1>Data Plane Operations
<a class=anchor href=#data-plane-operations-1>#</a></h2><p>The following sections describe complete Layer 2 and Layer 3 scenarios for reference:</p><h3 id=egress-traffic-flow-1>Egress Traffic Flow
<a class=anchor href=#egress-traffic-flow-1>#</a></h3><p>When Layer 2 traffic arrives at the veth interface and the destination belongs to the same subnet, the traffic is encapsulated and directed to the VTEP where the endpoint with the MAC address corresponding to the destination IP is located.</p><p><img src=/images/openpel2egress.svg alt></p><p>If the destination IP is on a different subnet, the traffic is routed to the L3 domain that the VNI is connected to, and it&rsquo;s routed via the L3 VNI corresponding to the VRF that the veth interface is attached to.</p><p><img src=/images/openpel3egress.svg alt></p><h3 id=ingress-traffic-flow-1>Ingress Traffic Flow
<a class=anchor href=#ingress-traffic-flow-1>#</a></h3><p>The ingress flow follows the reverse path of the egress flow. For Layer 2 traffic, VXLAN packets are decapsulated and forwarded to the appropriate veth interface. For Layer 3 traffic, packets are routed through the VRF and then forwarded to the host via the veth interface. The process is straightforward and doesn&rsquo;t require additional explanation beyond what has already been covered in the egress flow descriptions.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#underlay-connectivity>Underlay Connectivity</a><ul><li><a href=#vtep-ip-assignment>VTEP IP Assignment</a></li></ul></li><li><a href=#overlay-networks-vnis>Overlay Networks (VNIs)</a><ul><li><a href=#virtual-network-identifiers>Virtual Network Identifiers</a></li><li><a href=#l3-vni-components>L3 VNI Components</a></li></ul></li><li><a href=#control-plane-operations>Control Plane Operations</a><ul><li><a href=#route-advertisement-host--fabric>Route Advertisement (Host → Fabric)</a></li><li><a href=#route-reception-fabric--host>Route Reception (Fabric → Host)</a></li></ul></li><li><a href=#data-plane-operations>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow>Ingress Traffic Flow</a></li></ul></li><li><a href=#l2-vni>L2 VNI</a><ul><li></li></ul></li><li><a href=#data-plane-operations-1>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow-1>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow-1>Ingress Traffic Flow</a></li></ul></li></ul></nav></div></aside></main></body></html>