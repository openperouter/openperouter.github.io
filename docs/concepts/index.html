<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="What is OpenPERouter and how to use it"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://openperouter.github.io/openperouter/docs/concepts/"><meta property="og:site_name" content="OpenPERouter official docs"><meta property="og:title" content="Concepts"><meta property="og:description" content="What is OpenPERouter and how to use it"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-06-15T15:03:22+02:00"><meta property="article:modified_time" content="2025-06-15T15:03:22+02:00"><title>Concepts | OpenPERouter official docs</title><link rel=icon href=/openperouter/favicon.png><link rel=manifest href=/openperouter/manifest.json><link rel=canonical href=https://openperouter.github.io/openperouter/docs/concepts/><link rel=stylesheet href=/openperouter/book.min.d5e59cb0aa8d22a5813c62cd5e25d3d172489a369c61dc3f622ee96ae1ebb457.css integrity="sha256-1eWcsKqNIqWBPGLNXiXT0XJImjacYdw/Yi7pauHrtFc=" crossorigin=anonymous><script defer src=/openperouter/fuse.min.js></script><script defer src=/openperouter/en.search.min.7ceb4100d6a41c25288e467ea9b012a93b1fc6e6189ecc2fea33ab7a9d91e07d.js integrity="sha256-fOtBANakHCUojkZ+qbASqTsfxuYYnswv6jOrep2R4H0=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/openperouter/><span>OpenPERouter official docs</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/openperouter/docs/concepts/ class=active>Concepts</a></li><li><a href=/openperouter/docs/architecture/>Architecture</a></li><li><a href=/openperouter/docs/installation/>Installation</a></li><li><a href=/openperouter/docs/configuration/>Configuration</a></li><li><a href=/openperouter/docs/examples/>Examples</a><ul><li><a href=/openperouter/docs/examples/metallb/>MetalLB Integration</a></li></ul></li><li><a href=/openperouter/docs/api-reference/>API Reference</a></li><li><a href=/openperouter/docs/contributing/>Contributing</a><ul><li><a href=/openperouter/docs/contributing/devenv/>The development environment</a></li><li><a href=/openperouter/docs/contributing/code-of-conduct/>Code of Conduct</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/openperouter/svg/menu.svg class=book-icon alt=Menu></label><h3>Concepts</h3><label for=toc-control><img src=/openperouter/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-architecture>Network Architecture</a><ul><li><a href=#traditional-vs-openperouter-architecture>Traditional vs. OpenPERouter Architecture</a></li><li><a href=#key-components>Key Components</a></li></ul></li><li><a href=#underlay-connectivity>Underlay Connectivity</a><ul><li><a href=#fabric-integration>Fabric Integration</a></li></ul></li><li><a href=#overlay-networks-vnis>Overlay Networks (VNIs)</a><ul><li><a href=#virtual-network-identifiers>Virtual Network Identifiers</a></li><li><a href=#l3-vni-components>L3 VNI Components</a></li></ul></li><li><a href=#control-plane-operations>Control Plane Operations</a><ul><li><a href=#route-advertisement-host--fabric>Route Advertisement (Host → Fabric)</a></li><li><a href=#route-reception-fabric--host>Route Reception (Fabric → Host)</a></li></ul></li><li><a href=#data-plane-operations>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow>Ingress Traffic Flow</a></li></ul></li><li><a href=#l2-vni>L2 VNI</a><ul><li></li></ul></li><li><a href=#data-plane-operations-1>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow-1>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow-1>Ingress Traffic Flow</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>This section explains the core concepts behind OpenPERouter and how it integrates with your network infrastructure.</p><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p>OpenPERouter transforms Kubernetes nodes into Provider Edge (PE) routers by running <a href=https://frrouting.org/>FRR</a> in a dedicated network namespace. This enables EVPN (Ethernet VPN) functionality directly on your Kubernetes nodes, eliminating the need for external PE routers.</p><h2 id=network-architecture>Network Architecture
<a class=anchor href=#network-architecture>#</a></h2><h3 id=traditional-vs-openperouter-architecture>Traditional vs. OpenPERouter Architecture
<a class=anchor href=#traditional-vs-openperouter-architecture>#</a></h3><p>In traditional deployments, Kubernetes nodes connect to Top-of-Rack (ToR) switches via VLANs, and external PE routers handle EVPN tunneling. OpenPERouter moves this PE functionality directly into the Kubernetes nodes.</p><p><img src=/images/openpedescription.svg alt></p><h3 id=key-components>Key Components
<a class=anchor href=#key-components>#</a></h3><p>OpenPERouter consists of three main components:</p><ol><li><strong>Router Pod</strong>: Runs <a href=https://frrouting.org/>FRR</a> in a dedicated network namespace</li><li><strong>Controller Pod</strong>: Manages network configuration and orchestrates the router setup</li><li><strong>Node Labeler</strong>: Assigns persistent node indices for resource allocation</li></ol><h2 id=underlay-connectivity>Underlay Connectivity
<a class=anchor href=#underlay-connectivity>#</a></h2><h3 id=fabric-integration>Fabric Integration
<a class=anchor href=#fabric-integration>#</a></h3><p>OpenPERouter integrates with your network fabric by establishing BGP sessions with external routers (typically ToR switches).</p><h4 id=network-interface-management>Network Interface Management
<a class=anchor href=#network-interface-management>#</a></h4><p>OpenPERouter works by moving the physical network interface connected to the ToR switch into the router&rsquo;s network namespace:</p><p><img src=/images/openpehostnic.svg alt></p><p>This allows the router to establish direct BGP sessions with the fabric and receive routing information.</p><h4 id=vtep-ip-assignment>VTEP IP Assignment
<a class=anchor href=#vtep-ip-assignment>#</a></h4><p>Each OpenPERouter instance is assigned a unique VTEP (Virtual Tunnel End Point) IP address from a configured CIDR range. This VTEP IP serves as the identifier for the router within the fabric.</p><p>OpenPERouter establishes a BGP session with the fabric, advertising its VTEP IP to other routers. The VPN address family is enabled on this session, allowing the exchange of EVPN routes required for overlay connectivity.</p><p><img src=/images/openpebgpfabric.png alt></p><h2 id=overlay-networks-vnis>Overlay Networks (VNIs)
<a class=anchor href=#overlay-networks-vnis>#</a></h2><h3 id=virtual-network-identifiers>Virtual Network Identifiers
<a class=anchor href=#virtual-network-identifiers>#</a></h3><p>OpenPERouter supports the creation of multiple VNIs (Virtual Network Identifiers), each corresponding to a separate EVPN tunnel. This enables multi-tenancy and network segmentation.</p><p>OpenPERouter supports the creation of L3 VNIs, allowing the extension of a routed domain via an
EVPN overlay:</p><p><img src=/images/openpebgphost.svg alt></p><p>It supports the creation of L2 VNIs, where the veth is directly connected to a layer 2 domain</p><p><img src=/images/openpel2host.svg alt></p><p>And it also supports a mixed scenario, where an L2 domain also belongs to a broader L3 domain
mapped to an L3 overlay</p><p><img src=/images/openpel2l3host.svg alt></p><h3 id=l3-vni-components>L3 VNI Components
<a class=anchor href=#l3-vni-components>#</a></h3><p>For each Layer 3 VNI, OpenPERouter automatically creates:</p><ul><li><strong>Veth Pair</strong>: Named after the VNI (e.g., <code>host-200@pe-200</code>) for host connectivity</li><li><strong>BGP Session</strong>: Configured over the veth pair connecting the router to the host, to allow BGP
connectivity with the host</li><li><strong>Linux VRF</strong>: Isolates the routing space for each VNI within the router&rsquo;s network namespace</li><li><strong>VXLAN Interface</strong>: Handles tunnel encapsulation/decapsulation</li><li><strong>Route Translation</strong>: Converts between BGP routes and EVPN Type 5 routes</li></ul><h4 id=ip-allocation-strategy>IP Allocation Strategy
<a class=anchor href=#ip-allocation-strategy>#</a></h4><p>The IP addresses for the veth pair are allocated from the configured <code>localcidr</code> for each VNI:</p><ul><li><strong>Router side</strong>: Always gets the first IP in the CIDR (e.g., <code>192.169.11.0</code>)</li><li><strong>Host side</strong>: Each node gets a different IP from the CIDR, starting from the second value (e.g., <code>192.169.11.15</code>)</li></ul><p>This consistent allocation strategy of the router IP simplifies configuration across all nodes, as any BGP-speaking
component on the host can use the same IP address for the router side of the veth pair.</p><h2 id=control-plane-operations>Control Plane Operations
<a class=anchor href=#control-plane-operations>#</a></h2><h3 id=route-advertisement-host--fabric>Route Advertisement (Host → Fabric)
<a class=anchor href=#route-advertisement-host--fabric>#</a></h3><p>When a BGP-speaking component (like MetalLB) advertises a prefix to OpenPERouter:</p><p><img src=/images/openpeadvertise.svg alt></p><ol><li>The host advertises the route with the veth interface IP as the next hop</li><li>OpenPERouter learns the route via the BGP session</li><li>OpenPERouter translates the route to an EVPN Type 5 route</li><li>The EVPN route is advertised to the fabric with the local VTEP as the next hop</li></ol><h3 id=route-reception-fabric--host>Route Reception (Fabric → Host)
<a class=anchor href=#route-reception-fabric--host>#</a></h3><p>When EVPN Type 5 routes are received from the fabric:</p><p><img src=/images/openpereceive.svg alt></p><ol><li>OpenPERouter installs the routes in the VRF corresponding to the VNI</li><li>OpenPERouter translates the EVPN routes to BGP routes</li><li>The BGP routes are advertised to the host via the veth interface</li><li>The host&rsquo;s BGP-speaking component learns and installs the routes</li></ol><h2 id=data-plane-operations>Data Plane Operations
<a class=anchor href=#data-plane-operations>#</a></h2><h3 id=egress-traffic-flow>Egress Traffic Flow
<a class=anchor href=#egress-traffic-flow>#</a></h3><p>Traffic destined for networks learned via EVPN follows this path:</p><ol><li><strong>Host Routing</strong>: Traffic is redirected to the veth interface corresponding to the VNI</li><li><strong>Encapsulation</strong>: OpenPERouter encapsulates the traffic in VXLAN packets with the appropriate VNI</li><li><strong>Fabric Routing</strong>: The fabric routes the VXLAN packets to the destination VTEP</li><li><strong>Delivery</strong>: The destination endpoint instance receives and processes the traffic</li></ol><h3 id=ingress-traffic-flow>Ingress Traffic Flow
<a class=anchor href=#ingress-traffic-flow>#</a></h3><p>VXLAN packets received from the fabric are processed as follows:</p><ol><li><strong>Decapsulation</strong>: OpenPERouter removes the VXLAN header</li><li><strong>VRF Routing</strong>: Traffic is routed within the VRF corresponding to the VNI</li><li><strong>Host Delivery</strong>: Traffic is forwarded to the host via the veth interface</li><li><strong>Final Routing</strong>: The host routes the traffic to the appropriate destination</li></ol><h2 id=l2-vni>L2 VNI
<a class=anchor href=#l2-vni>#</a></h2><p>For each Layer 2 VNI, OpenPERouter automatically creates:</p><ul><li><strong>Veth Pair</strong>: Named after the VNI (e.g., <code>host-200@pe-200</code>) for Layer 2 host connectivity</li><li><strong>Linux VRF</strong>: Optional, isolates the routing space for each VNI within the router&rsquo;s network namespace</li><li><strong>VXLAN Interface</strong>: Handles tunnel encapsulation/decapsulation</li></ul><h4 id=host-interface-management>Host Interface Management
<a class=anchor href=#host-interface-management>#</a></h4><p>Given the Layer 2 nature of these connections, OpenPERouter supports multiple interface management options:</p><ul><li><strong>Attaching to an existing bridge</strong>: If a bridge already exists and is used by other components, OpenPERouter can attach the veth interface to it</li><li><strong>Creating a new bridge</strong>: OpenPERouter can create a bridge and attach the veth interface directly to it.</li><li><strong>Direct veth usage</strong>: With the understanding that the veth interface may disappear if the pod gets restarted, the veth can be used directly to extend an existing Layer 2 domain</li></ul><h5 id=automatic-bridge-creation>Automatic Bridge Creation
<a class=anchor href=#automatic-bridge-creation>#</a></h5><p>The automatic bridge creation is useful for those scenarios where an existing layer 2 domain is extended automatically through the veth interface:
when the router pod is deleted or restarted, the veth interface is removed (and then recreated upon reconciliation), while the bridge remains intact,
making it a good candidate for attaching to an existing layer 2 domain (i.e. setting it as master of a macvlan multus interface).</p><h2 id=data-plane-operations-1>Data Plane Operations
<a class=anchor href=#data-plane-operations-1>#</a></h2><p>The following sections describe complete Layer 2 and Layer 3 scenarios for reference:</p><h3 id=egress-traffic-flow-1>Egress Traffic Flow
<a class=anchor href=#egress-traffic-flow-1>#</a></h3><p>When Layer 2 traffic arrives at the veth interface and the destination belongs to the same subnet, the traffic is encapsulated and directed to the VTEP where the endpoint with the MAC address corresponding to the destination IP is located.</p><p><img src=/images/openpel2egress.svg alt></p><p>If the destination IP is on a different subnet, the traffic is routed to the L3 domain that the VNI is connected to, and it&rsquo;s routed via the L3 VNI corresponding to the VRF that the veth interface is attached to.</p><p><img src=/images/openpel3egress.svg alt></p><h3 id=ingress-traffic-flow-1>Ingress Traffic Flow
<a class=anchor href=#ingress-traffic-flow-1>#</a></h3><p>The ingress flow follows the reverse path of the egress flow. For Layer 2 traffic, VXLAN packets are decapsulated and forwarded to the appropriate veth interface. For Layer 3 traffic, packets are routed through the VRF and then forwarded to the host via the veth interface. The process is straightforward and doesn&rsquo;t require additional explanation beyond what has already been covered in the egress flow descriptions.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-architecture>Network Architecture</a><ul><li><a href=#traditional-vs-openperouter-architecture>Traditional vs. OpenPERouter Architecture</a></li><li><a href=#key-components>Key Components</a></li></ul></li><li><a href=#underlay-connectivity>Underlay Connectivity</a><ul><li><a href=#fabric-integration>Fabric Integration</a></li></ul></li><li><a href=#overlay-networks-vnis>Overlay Networks (VNIs)</a><ul><li><a href=#virtual-network-identifiers>Virtual Network Identifiers</a></li><li><a href=#l3-vni-components>L3 VNI Components</a></li></ul></li><li><a href=#control-plane-operations>Control Plane Operations</a><ul><li><a href=#route-advertisement-host--fabric>Route Advertisement (Host → Fabric)</a></li><li><a href=#route-reception-fabric--host>Route Reception (Fabric → Host)</a></li></ul></li><li><a href=#data-plane-operations>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow>Ingress Traffic Flow</a></li></ul></li><li><a href=#l2-vni>L2 VNI</a><ul><li></li></ul></li><li><a href=#data-plane-operations-1>Data Plane Operations</a><ul><li><a href=#egress-traffic-flow-1>Egress Traffic Flow</a></li><li><a href=#ingress-traffic-flow-1>Ingress Traffic Flow</a></li></ul></li></ul></nav></div></aside></main></body></html>