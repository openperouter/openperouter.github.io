<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="What is OpenPERouter and how to use it"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://openperouter.github.io/docs/concepts/"><meta property="og:site_name" content="OpenPERouter official docs"><meta property="og:title" content="Concepts"><meta property="og:description" content="What is OpenPERouter and how to use it"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>Concepts | OpenPERouter official docs</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://openperouter.github.io/docs/concepts/><link rel=stylesheet href=/book.min.d5e59cb0aa8d22a5813c62cd5e25d3d172489a369c61dc3f622ee96ae1ebb457.css integrity="sha256-1eWcsKqNIqWBPGLNXiXT0XJImjacYdw/Yi7pauHrtFc=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.60407996de20572354319633a8fc3cab9ab19ed6fa71255686061c544a1ad020.js integrity="sha256-YEB5lt4gVyNUMZYzqPw8q5qxntb6cSVWhgYcVEoa0CA=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://openperouter.github.io/docs/concepts/index.xml title="OpenPERouter official docs"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>OpenPERouter official docs</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/concepts/ class=active>Concepts</a><ul><li><a href=/docs/concepts/evpn/>EVPN - VXLan</a></li><li><a href=/docs/concepts/passthrough/>L3 Passthrough</a></li></ul></li><li><a href=/docs/architecture/>Architecture</a></li><li><a href=/docs/installation/>Installation</a></li><li><a href=/docs/configuration/>Configuration</a><ul><li><a href=/docs/configuration/evpn/>EVPN Configuration</a></li><li><a href=/docs/configuration/passthrough/>Passthrough Configuration</a></li></ul></li><li><a href=/docs/examples/>Examples</a><ul><li><a href=/docs/examples/evpnexamples/>EVPN Examples</a><ul><li><a href=/docs/examples/evpnexamples/metallb/>MetalLB Integration</a></li><li><a href=/docs/examples/evpnexamples/kubevirt-multi-cluster/>Stretching a layer 2 overlay across multiple KubeVirt clusters</a></li><li><a href=/docs/examples/evpnexamples/calico/>Calico Integration</a></li><li><a href=/docs/examples/evpnexamples/kubevirt/>KubeVirt L2 Integration</a></li><li><a href=/docs/examples/evpnexamples/layer2/>Layer 2 Integration</a></li></ul></li><li><a href=/docs/examples/passthroughexamples/>Passthrough Examples</a><ul><li><a href=/docs/examples/passthroughexamples/metallb/>MetalLB Integration</a></li></ul></li></ul></li><li><a href=/docs/api-reference/>API Reference</a></li><li><a href=/docs/contributing/>Contributing</a><ul><li><a href=/docs/contributing/devenv/>The development environment</a></li><li><a href=/docs/contributing/code-of-conduct/>Code of Conduct</a></li><li><a href=/docs/contributing/how-to-release/>How to release</a></li></ul></li><li><a href=/docs/release-notes/>Release Notes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Concepts</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-architecture>Network Architecture</a><ul><li><a href=#traditional-vs-openperouter-architecture>Traditional vs. OpenPERouter Architecture</a></li><li><a href=#key-components>Key Components</a></li></ul></li><li><a href=#underlay-connectivity>Underlay Connectivity</a><ul><li><a href=#fabric-integration>Fabric Integration</a></li></ul></li><li><a href=#overlay-networks-vpns>Overlay Networks (VPNs)</a><ul><li><a href=#virtual-networks>Virtual Networks</a></li><li><a href=#l3-vpn-components>L3 VPN Components</a></li></ul></li><li><a href=#control-plane-operations>Control Plane Operations</a><ul><li><a href=#route-advertisement-host--fabric>Route Advertisement (Host → Fabric)</a></li><li><a href=#route-reception-fabric--host>Route Reception (Fabric → Host)</a></li></ul></li><li><a href=#l2-vpn>L2 VPN</a><ul><li><a href=#host-interface-management>Host Interface Management</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>This section explains the core concepts behind OpenPERouter and how it integrates with your network infrastructure.</p><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p>OpenPERouter transforms Kubernetes nodes into Provider Edge (PE) routers by running <a href=https://frrouting.org/>FRR</a> in a dedicated network namespace. This enables EVPN (Ethernet VPN) functionality directly on your Kubernetes nodes, eliminating the need for external PE routers.</p><h2 id=network-architecture>Network Architecture
<a class=anchor href=#network-architecture>#</a></h2><h3 id=traditional-vs-openperouter-architecture>Traditional vs. OpenPERouter Architecture
<a class=anchor href=#traditional-vs-openperouter-architecture>#</a></h3><p>In traditional deployments, Kubernetes nodes connect to Top-of-Rack (ToR) switches via VLANs, and external PE routers handle EVPN tunneling. OpenPERouter moves this PE functionality directly into the Kubernetes nodes.</p><p><img src=/images/openpedescription.svg alt></p><h3 id=key-components>Key Components
<a class=anchor href=#key-components>#</a></h3><p>OpenPERouter consists of three main components:</p><ol><li><strong>Router Pod</strong>: Runs <a href=https://frrouting.org/>FRR</a> in a dedicated network namespace</li><li><strong>Controller Pod</strong>: Manages network configuration and orchestrates the router setup</li><li><strong>Node Labeler</strong>: Assigns persistent node indices for resource allocation</li></ol><h2 id=underlay-connectivity>Underlay Connectivity
<a class=anchor href=#underlay-connectivity>#</a></h2><h3 id=fabric-integration>Fabric Integration
<a class=anchor href=#fabric-integration>#</a></h3><p>OpenPERouter integrates with your network fabric by establishing BGP sessions with external routers (typically ToR switches).</p><h4 id=network-interface-management>Network Interface Management
<a class=anchor href=#network-interface-management>#</a></h4><p>OpenPERouter works by moving the physical network interface connected to the ToR switch into the router&rsquo;s network namespace:</p><p><img src=/images/openpehostnic.svg alt></p><p>This allows the router to establish direct BGP sessions with the fabric and receive routing information.</p><h2 id=overlay-networks-vpns>Overlay Networks (VPNs)
<a class=anchor href=#overlay-networks-vpns>#</a></h2><h3 id=virtual-networks>Virtual Networks
<a class=anchor href=#virtual-networks>#</a></h3><p>OpenPERouter supports the creation of multiple VPNs, each corresponding to a separate VPN tunnel. This enables multi-tenancy and network segmentation.</p><p>OpenPERouter supports the creation of multiple VPNs, allowing the extension of a routed domain via a
VPN overlay:</p><p><img src=/images/openpehostvpnl3.svg alt></p><p>It supports the creation of L2 VPNs (where possible), where the veth is directly connected to a layer 2 domain</p><p><img src=/images/openpel2hostvpn.svg alt></p><p>And it also supports a mixed scenario, where an L2 domain also belongs to a broader L3 domain
mapped to an L3 overlay</p><p><img src=/images/openpel2l3host.svg alt></p><h3 id=l3-vpn-components>L3 VPN Components
<a class=anchor href=#l3-vpn-components>#</a></h3><p>For each Layer 3 VNI, OpenPERouter automatically creates:</p><ul><li><strong>Veth Pair</strong>: Named after the VPN (e.g., <code>host-200@pe-200</code> in case of EVPN) for host connectivity</li><li><strong>BGP Session</strong>: Configured over the veth pair connecting the router to the host, to allow BGP
connectivity with the host</li><li><strong>Linux VRF</strong>: Isolates the routing space for each VNI within the router&rsquo;s network namespace</li><li><strong>Route Translation</strong>: Converts between BGP routes and L3 VPN routes</li></ul><h4 id=ip-allocation-strategy>IP Allocation Strategy
<a class=anchor href=#ip-allocation-strategy>#</a></h4><p>The IP addresses for the veth pair are allocated from the configured <code>localcidr</code> for each VNI:</p><ul><li><strong>Router side</strong>: Always gets the first IP in the CIDR (e.g., <code>192.169.11.0</code>)</li><li><strong>Host side</strong>: Each node gets a different IP from the CIDR, starting from the second value (e.g., <code>192.169.11.15</code>)</li></ul><p>This consistent allocation strategy of the router IP simplifies configuration across all nodes, as any BGP-speaking
component on the host can use the same IP address for the router side of the veth pair.</p><h2 id=control-plane-operations>Control Plane Operations
<a class=anchor href=#control-plane-operations>#</a></h2><h3 id=route-advertisement-host--fabric>Route Advertisement (Host → Fabric)
<a class=anchor href=#route-advertisement-host--fabric>#</a></h3><p>When a BGP-speaking component (like MetalLB) advertises a prefix to OpenPERouter:</p><p><img src=/images/openpeadvertise.svg alt></p><ol><li>The host advertises the route with the veth interface IP as the next hop</li><li>OpenPERouter learns the route via the BGP session</li><li>OpenPERouter translates the route to an L3VPN route</li><li>The VPN route is advertised to the fabric with the local router as the next hop</li></ol><h3 id=route-reception-fabric--host>Route Reception (Fabric → Host)
<a class=anchor href=#route-reception-fabric--host>#</a></h3><p>When EVPN Type 5 routes are received from the fabric:</p><p><img src=/images/openpereceive.svg alt></p><ol><li>OpenPERouter installs the routes in the VRF corresponding to the VPN</li><li>OpenPERouter translates the VPN routes to BGP routes</li><li>The BGP routes are advertised to the host via the veth interface</li><li>The host&rsquo;s BGP-speaking component learns and installs the routes</li></ol><h2 id=l2-vpn>L2 VPN
<a class=anchor href=#l2-vpn>#</a></h2><p>For each Layer 2 VPN, OpenPERouter automatically creates:</p><ul><li><strong>Veth Pair</strong>: Named after the VNI (e.g., <code>host-200@pe-200</code>) for Layer 2 host connectivity</li><li><strong>Linux VRF</strong>: Optional, isolates the routing space for each VPN within the router&rsquo;s network namespace</li></ul><h3 id=host-interface-management>Host Interface Management
<a class=anchor href=#host-interface-management>#</a></h3><p>Given the Layer 2 nature of these connections, OpenPERouter supports multiple interface management options:</p><ul><li><strong>Attaching to an existing bridge</strong>: If a bridge already exists and is used by other components, OpenPERouter can attach the veth interface to it</li><li><strong>Creating a new bridge</strong>: OpenPERouter can create a bridge and attach the veth interface directly to it.</li><li><strong>Direct veth usage</strong>: With the understanding that the veth interface may disappear if the pod gets restarted, the veth can be used directly to extend an existing Layer 2 domain</li></ul><h4 id=automatic-bridge-creation>Automatic Bridge Creation
<a class=anchor href=#automatic-bridge-creation>#</a></h4><p>The automatic bridge creation is useful for those scenarios where an existing layer 2 domain is extended automatically through the veth interface:
when the router pod is deleted or restarted, the veth interface is removed (and then recreated upon reconciliation), while the bridge remains intact,
making it a good candidate for attaching to an existing layer 2 domain (i.e. setting it as master of a macvlan multus interface).</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-architecture>Network Architecture</a><ul><li><a href=#traditional-vs-openperouter-architecture>Traditional vs. OpenPERouter Architecture</a></li><li><a href=#key-components>Key Components</a></li></ul></li><li><a href=#underlay-connectivity>Underlay Connectivity</a><ul><li><a href=#fabric-integration>Fabric Integration</a></li></ul></li><li><a href=#overlay-networks-vpns>Overlay Networks (VPNs)</a><ul><li><a href=#virtual-networks>Virtual Networks</a></li><li><a href=#l3-vpn-components>L3 VPN Components</a></li></ul></li><li><a href=#control-plane-operations>Control Plane Operations</a><ul><li><a href=#route-advertisement-host--fabric>Route Advertisement (Host → Fabric)</a></li><li><a href=#route-reception-fabric--host>Route Reception (Fabric → Host)</a></li></ul></li><li><a href=#l2-vpn>L2 VPN</a><ul><li><a href=#host-interface-management>Host Interface Management</a></li></ul></li></ul></nav></div></aside></main></body></html>