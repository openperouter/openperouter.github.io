<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Integrate Open PE Router with MetalLB for LoadBalancer service advertisement"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://openperouter.github.io/docs/examples/metallb/"><meta property="og:site_name" content="OpenPERouter official docs"><meta property="og:title" content="MetalLB Integration"><meta property="og:description" content="Integrate Open PE Router with MetalLB for LoadBalancer service advertisement"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-06-15T15:03:22+02:00"><meta property="article:modified_time" content="2025-06-15T15:03:22+02:00"><title>MetalLB Integration | OpenPERouter official docs</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://openperouter.github.io/docs/examples/metallb/><link rel=stylesheet href=/book.min.d5e59cb0aa8d22a5813c62cd5e25d3d172489a369c61dc3f622ee96ae1ebb457.css integrity="sha256-1eWcsKqNIqWBPGLNXiXT0XJImjacYdw/Yi7pauHrtFc=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.2ccdfa4c9e981d799e66477e7ecf8337adc12b18b7edea0f219ee206985bc936.js integrity="sha256-LM36TJ6YHXmeZkd+fs+DN63BKxi37eoPIZ7iBphbyTY=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>OpenPERouter official docs</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/concepts/>Concepts</a></li><li><a href=/docs/architecture/>Architecture</a></li><li><a href=/docs/installation/>Installation</a></li><li><a href=/docs/configuration/>Configuration</a></li><li><a href=/docs/examples/>Examples</a><ul><li><a href=/docs/examples/metallb/ class=active>MetalLB Integration</a></li><li><a href=/docs/examples/calico/>Calico Integration</a></li><li><a href=/docs/examples/layer2/>Layer 2 Integration</a></li></ul></li><li><a href=/docs/api-reference/>API Reference</a></li><li><a href=/docs/contributing/>Contributing</a><ul><li><a href=/docs/contributing/devenv/>The development environment</a></li><li><a href=/docs/contributing/code-of-conduct/>Code of Conduct</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>MetalLB Integration</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#overview>Overview</a><ul><li><a href=#example-setup>Example Setup</a></li></ul></li><li><a href=#route-advertisement-flow>Route Advertisement Flow</a></li><li><a href=#traffic-flow>Traffic Flow</a></li><li><a href=#configuration>Configuration</a><ul><li><a href=#l3-vni-configuration>L3 VNI Configuration</a></li><li><a href=#metallb-bgp-peer-configuration>MetalLB BGP Peer Configuration</a></li><li><a href=#bgp-advertisement-configuration>BGP Advertisement Configuration</a></li></ul></li><li><a href=#return-traffic-configuration>Return Traffic Configuration</a></li><li><a href=#verification>Verification</a><ul><li><a href=#check-bgp-session-status>Check BGP Session Status</a></li><li><a href=#test-service-connectivity>Test Service Connectivity</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>This example demonstrates how to integrate OpenPERouter with MetalLB to advertise LoadBalancer services across the EVPN fabric, enabling external access to Kubernetes services.</p><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p>MetalLB provides load balancing for Kubernetes services by advertising service IPs via BGP. When integrated with OpenPERouter, these BGP routes are automatically converted to EVPN Type 5 routes, making the services reachable across the entire fabric.</p><h3 id=example-setup>Example Setup
<a class=anchor href=#example-setup>#</a></h3><p>The full example can be found in the <a href=https://github.com/openperouter/openperouter/examples/metallb>project repository</a> and can be deployed by running</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make demo-metallb
</span></span></code></pre></div><p>This example exposes two different services over two different overlays by configuring two L3 VNIs on the OpenPERouter and peering MetalLB on the sessions corresponding to each VNI.</p><figure class=text-center><img src=/images/openpemetallbtwosessions.svg alt="MetalLB Two Sessions"></figure><h2 id=route-advertisement-flow>Route Advertisement Flow
<a class=anchor href=#route-advertisement-flow>#</a></h2><p>Once configured, the integration works as follows:</p><p><img src=/images/openpeemetallbroutes.svg alt="MetalLB Route Flow"></p><ol><li><strong>Service Creation</strong>: Kubernetes LoadBalancer service is created with an IP from the pool</li><li><strong>MetalLB Processing</strong>: MetalLB assigns an IP and starts advertising it via BGP</li><li><strong>BGP Session</strong>: MetalLB advertises the route to OpenPERouter through the veth interface</li><li><strong>EVPN Conversion</strong>: OpenPERouter converts the BGP route to EVPN Type 5 route</li><li><strong>Fabric Distribution</strong>: The EVPN route is distributed to all fabric routers</li><li><strong>External Reachability</strong>: External hosts can now reach the service through the fabric</li></ol><h2 id=traffic-flow>Traffic Flow
<a class=anchor href=#traffic-flow>#</a></h2><p>When external traffic reaches the service:</p><p><img src=/images/openpeemetallbtraffic.svg alt="MetalLB Traffic Flow"></p><ol><li><strong>External Request</strong>: External host sends traffic to the service IP</li><li><strong>Fabric Routing</strong>: Fabric routes the traffic to an appropriate VTEP</li><li><strong>VXLAN Encapsulation</strong>: Traffic is encapsulated in VXLAN with the appropriate VNI</li><li><strong>OpenPERouter Processing</strong>: OpenPERouter receives and decapsulates the traffic</li><li><strong>Service Delivery</strong>: Traffic is forwarded to the Kubernetes service endpoint</li><li><strong>Service Reply</strong>: The service reply finds the route learned by FRR-K8s and is routed to the host that sent the request</li></ol><h2 id=configuration>Configuration
<a class=anchor href=#configuration>#</a></h2><h3 id=l3-vni-configuration>L3 VNI Configuration
<a class=anchor href=#l3-vni-configuration>#</a></h3><p>Configure one L3VNI for each overlay:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>openpe.openperouter.github.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>L3VNI</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>red</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openperouter-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>asn</span>: <span style=color:#ae81ff>64514</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vni</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>localcidr</span>: <span style=color:#ae81ff>192.169.10.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hostasn</span>: <span style=color:#ae81ff>64515</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>openpe.openperouter.github.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>L3VNI</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>blue</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openperouter-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>asn</span>: <span style=color:#ae81ff>64514</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vni</span>: <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>localcidr</span>: <span style=color:#ae81ff>192.169.11.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hostasn</span>: <span style=color:#ae81ff>64515</span>
</span></span></code></pre></div><h3 id=metallb-bgp-peer-configuration>MetalLB BGP Peer Configuration
<a class=anchor href=#metallb-bgp-peer-configuration>#</a></h3><p>On the MetalLB side, configure the corresponding <code>BGPPeer</code> resources:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>metallb.io/v1beta2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BGPPeer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>peerred</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>metallb-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>myASN</span>: <span style=color:#ae81ff>64515</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>peerASN</span>: <span style=color:#ae81ff>64514</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>peerAddress</span>: <span style=color:#ae81ff>192.169.10.1</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>metallb.io/v1beta2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BGPPeer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>peerblue</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>metallb-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>myASN</span>: <span style=color:#ae81ff>64515</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>peerASN</span>: <span style=color:#ae81ff>64514</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>peerAddress</span>: <span style=color:#ae81ff>192.169.11.1</span>
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: The <code>peerAddress</code> field specifies the router-side IP address. MetalLB establishes BGP sessions with OpenPERouter through the veth interfaces created for each VNI. Since the router-side IP is consistent across all nodes, you only need one BGPPeer configuration per VNI.</p></blockquote><h3 id=bgp-advertisement-configuration>BGP Advertisement Configuration
<a class=anchor href=#bgp-advertisement-configuration>#</a></h3><p>MetalLB is configured with two address pools associated with two different namespaces (omitted here for brevity) and configured to advertise each pool to the corresponding <code>BGPPeer</code>:</p><p><img src=/images/openpemetallbvniroutes.svg alt="MetalLB VNI Routes"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>metallb.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BGPAdvertisement</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bgp-advertisement-red</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>metallb-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ipAddressPools</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>address-pool-red</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>peers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>peerred</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>metallb.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BGPAdvertisement</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bgp-advertisement-blue</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>metallb-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ipAddressPools</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>address-pool-blue</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>peers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>peerblue</span>
</span></span></code></pre></div><h2 id=return-traffic-configuration>Return Traffic Configuration
<a class=anchor href=#return-traffic-configuration>#</a></h2><p>Once the pod behind the service replies, the traffic must find its way back to the host that sent the request.</p><p><img src=/images/openpemetallbreply.svg alt="MetalLB Reply Flow"></p><p>To enable this, the host must learn the routes advertised by the two leaves (leafA and leafB) via BGP. We leverage the integration with <a href=https://github.com/metallb/frr-k8s/>frr-k8s</a> to add a configuration that allows incoming routes to be added to the host:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>frrk8s.metallb.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>FRRConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>receive-all </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>frr-k8s-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>bgp</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>routers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>asn</span>: <span style=color:#ae81ff>64515</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>neighbors</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>address</span>: <span style=color:#ae81ff>192.169.10.1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>asn</span>: <span style=color:#ae81ff>64514</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>toReceive</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>allowed</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>all</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>address</span>: <span style=color:#ae81ff>192.169.11.1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>asn</span>: <span style=color:#ae81ff>64514</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>toReceive</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>allowed</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>all</span>
</span></span></code></pre></div><h2 id=verification>Verification
<a class=anchor href=#verification>#</a></h2><h3 id=check-bgp-session-status>Check BGP Session Status
<a class=anchor href=#check-bgp-session-status>#</a></h3><p>Verify that the BGP sessions between MetalLB/FRR-K8s and the OpenPERouter are established:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get bgpsessionstates.frrk8s.metallb.io -A
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>NAMESPACE        NAME                          NODE                    PEER           VRF   BGP           BFD
frr-k8s-system   pe-kind-control-plane-94ct2   pe-kind-control-plane   192.169.11.1         Established   N/1
frr-k8s-system   pe-kind-control-plane-bc9zh   pe-kind-control-plane   192.169.10.1         Established   N/A
frr-k8s-system   pe-kind-worker-496lk          pe-kind-worker          192.169.11.1         Established   N/A
frr-k8s-system   pe-kind-worker-s74kn          pe-kind-worker          192.169.10.1         Established   N/A
</code></pre><h3 id=test-service-connectivity>Test Service Connectivity
<a class=anchor href=#test-service-connectivity>#</a></h3><h4 id=test-from-red-overlay>Test from Red Overlay
<a class=anchor href=#test-from-red-overlay>#</a></h4><p>First, check the service details:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get svc -n red
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>NAME                TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
nginx-service-red   LoadBalancer   10.96.161.254   172.30.0.10   80:32732/TCP   2m3s
</code></pre><p>Test connectivity from a host connected to the red overlay:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec clab-kind-hostA_red curl 172.30.0.10
</span></span></code></pre></div><p>Expected output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>title</span>&gt;Welcome to nginx!&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>h1</span>&gt;Welcome to nginx!&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span>&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span style=display:flex><span>working. Further configuration is required.&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span>&gt;For online documentation and support please refer to
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/<span style=color:#f92672>a</span>&gt;.&lt;<span style=color:#f92672>br</span>/&gt;
</span></span><span style=display:flex><span>Commercial support is available at
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/<span style=color:#f92672>a</span>&gt;.&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span>&gt;&lt;<span style=color:#f92672>em</span>&gt;Thank you for using nginx.&lt;/<span style=color:#f92672>em</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><h4 id=test-from-blue-overlay>Test from Blue Overlay
<a class=anchor href=#test-from-blue-overlay>#</a></h4><p>Try to access the same service from a host connected to the blue overlay:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec clab-kind-hostA_blue curl --max-time <span style=color:#ae81ff>2</span> --no-progress-meter 172.30.0.10
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>curl: (28) Connection timed out after 2001 milliseconds
</code></pre><blockquote><p><strong>Expected Behavior</strong>: The connection times out because the service is advertised only to the red network, demonstrating the network isolation between overlays.</p></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#overview>Overview</a><ul><li><a href=#example-setup>Example Setup</a></li></ul></li><li><a href=#route-advertisement-flow>Route Advertisement Flow</a></li><li><a href=#traffic-flow>Traffic Flow</a></li><li><a href=#configuration>Configuration</a><ul><li><a href=#l3-vni-configuration>L3 VNI Configuration</a></li><li><a href=#metallb-bgp-peer-configuration>MetalLB BGP Peer Configuration</a></li><li><a href=#bgp-advertisement-configuration>BGP Advertisement Configuration</a></li></ul></li><li><a href=#return-traffic-configuration>Return Traffic Configuration</a></li><li><a href=#verification>Verification</a><ul><li><a href=#check-bgp-session-status>Check BGP Session Status</a></li><li><a href=#test-service-connectivity>Test Service Connectivity</a></li></ul></li></ul></nav></div></aside></main></body></html>